
<script src="geo.php"></script>

<script type="text/javascript">

    var map = L.map('map').setView([0, -0], 2);

    /* disable scroll wheel by default, toggle by click on map */
    map.scrollWheelZoom.disable();
    map.on('click', function() {
      if (map.scrollWheelZoom.enabled()) {
        map.scrollWheelZoom.disable();
      } else {
        map.scrollWheelZoom.enable();
      }
    });

    var icons = {
      ok: L.icon({
        iconUrl: 'images/svg/ok.svg',
        popupAnchor:  [0, 16],
        iconSize: [24, 24] // size of the icon
        }),

      alert: L.icon({
        iconUrl: 'images/svg/high_priority.svg',
        popupAnchor:  [0, 12],
        iconSize: [32, 32] // size of the icon
        }),
    };

      var tileUrl = 'http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}' + (L.Browser.retina? '@2x': '') + '.png';
      var layer = L.tileLayer(tileUrl, {
         detectRetina: true,
         attribution: 'Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attributions">CARTO</a>'
      }).addTo(map);

    var markers = L.geoJson(geojson);

    map.fitBounds(markers.getBounds(), { padding: [30, 30] });
    var markers_up = L.geoJson(geojson, {

      //pointToLayer: function (feature, latlng) {
      //  return L.circleMarker(latlng, geojsonMarkerOptions);
      //},

      filter: function(feature, layer) {
        return feature.properties.state == "up";
      },

      onEachFeature: function(feature, layer) {
            if (feature.properties && feature.properties.popupContent) {
                layer.bindPopup(feature.properties.popupContent, {closeButton: false, offset: L.point(0, -20)});
                layer.on('mouseover', function() { layer.openPopup(); });
                layer.on('mouseout', function() { layer.closePopup(); });
            }
            layer.on('click', function() { window.open(feature.properties.url, "_self"); });
        },

       pointToLayer: function (geojson, latlng) {
         return L.marker(latlng, {
           icon: icons['ok']
         });
       },

    }).addTo(map);

    var markers_down = L.geoJson(geojson, {

      //pointToLayer: function (feature, latlng) {
      //  return L.circleMarker(latlng, geojsonMarkerOptions);
      //},

      filter: function(feature, layer) {
        return feature.properties.state != "up";
      },

      onEachFeature: function(feature, layer) {
            if (feature.properties && feature.properties.popupContent) {
                layer.bindPopup(feature.properties.popupContent, {closeButton: false, offset: L.point(0, -20)});
                layer.on('mouseover', function() { layer.openPopup(); });
                layer.on('mouseout', function() { layer.closePopup(); });
            }
            layer.on('click', function() { window.open(feature.properties.url, "_self"); });
        },

       pointToLayer: function (geojson, latlng) {
         return L.marker(latlng, {
           icon: icons['alert'],
           zIndexOffset: 1000
         });
       },

    }).addTo(map);

</script>
